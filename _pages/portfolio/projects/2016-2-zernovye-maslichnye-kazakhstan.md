---
title: Zernovye & Maslichnye. Kazakhstan
site: https://margin.kz/
year: 2016 - Present
description: Informational and analytical resource about grain and oil-bearing crops in Kazakhstan.
technologies:
  - Python
  - Django
  - PostgreSQL
  - JavaScript
  - jQuery
  - Bootstrap
  - Sass
screenshots: [home, news, agrarian_map, trading_platform, adding_enterprise]
---

## История

Проект изначально планировался как подработка во время работы в компании "Fora". У информационно-аналитического бюро 
"Зерновые & Масличные. Казахстан" уже имелся сайт, написанный на Joomla, однако руководитель не был удовлетворен его 
работой и поддержкой. Кроме этого, планировалось множество улучшений, которые делали использование подобного рода CMS
нецелесообразным. Ключевой идеей с точки зрения бизнеса была возможность закрытия определенных частей контента от общего 
доступа и введения платных подписок для их просмотра.

Возможно, я бы не брался за проект, но я подумал, что это хорошая возможность параллельно изучить что-то новое из языков 
и технологий программирования и развиваться дальше, не ограничиваниясь стеком PHP + MySQL. Я выбрал Python и Django в 
комбинации с PostgreSQL. Оценив объем работ, а также учитывая некоторые другие обстоятельства, было принято решение об 
уходе с предыдущей работы, чтобы все рабочее время посвятить разработке этого проекта.
 
## Дизайн и верстка

Вместе с переносом на другую платформу, было принято решение о редизайне сайта. Для дизайна и верстки был привлечен мой 
коллега по прошлой работе.

### Верстка

После одобрения дизайна заказчиком, дальнейшие работы по верстке выполнялись самостоятельно:

- Исправление багов в оригинальных шаблонах.
- Оформление новых блоков и страниц.
- Использование Bootstrap для форм и уведомлений (статичных и всплывающих).
- Верстка писем для рассылок.

## Новости

Данный модуль уже присутствовал на действующем сайте, требовалась его доработка. Из нововведений можно выделить:

- Реализована обрезка основного изображения с учетом соотношения сторон для формирования ровной сетки в списке новостей.
= Добавлен поиск по тегам.
- Можно делать акцент на отдельных новостях, закрепляя их, либо отмечая как рекламные.
- Добавлены шаблоны для удобного использования часто повторяющихся частей текста.
= Добавлена возможность деактивации новости.
- Подключены комментарии Disqus, выполнены необходимые настройки для корректной публикации новости на Facebook.
- Настроены ЧПУ для категорий и новостей, причем для новостей используется связка с id таким образом, что название может
быть отредактировано в любой момент после публикации новости.
- Добавлена возможность включения закрытого платного контента в авторских новостях.

### Связанные доработки

Помимо новостей, на этом этапе были добавлены:

- Информационные страницы, как в CMS, с визуальным редактором, возможностью загрузки изображений и других файлов.
- Возможность вставки рекламных баннеров.
- Графики с возможностью импорта данных из Excel. Присутствовала возможность закрепления графика в правой колонке сайта
или привязке к одной из новостных категорий.
- Регистрация и вход с возможностью использовать социальные сервисы - Twitter, Google, Facebook, Vkontakte, личный 
кабинет для пользователей.

Был выполнен перенос контента и файлов со старого сайта, а также проведены базовые SEO мероприятия, включающие настройку 
редиректов в связи с изменениями в структуре ссылок.

Сайт был запущен в конце мая 2016 года.

### Дальнейшие доработки

Позже для графиков была подключена библиотека Highcharts, произведена интеграция с CKEditor.

## Аграрная карта

Аграрная карта Казахстана - новый инновационный модуль, которому, по словам заказчика, нет аналогов в Казахстане. Была 
реализована возможность формирования базы сельхозпредприятий Казахстана с удобным просмотром их местонахождения на 
карте:

- Для связи с географическими данными был добавлен модуль "География" с делением на области, районы и населенные пункты.
- Добавлен фильтр для быстрого поиска группы предприятий или конкретного предприятия.
- Реализована карта с группировкой предприятий в населенные пункты, кластеризацией всех маркеров для удобства
восприятия и быстрой загрузки и синхронизацией с фильтром.
- Пользователи могут принимать участие в заполнении базы предприятий, закрепляться за выбранным предприятием.
- Добавлен удобный способ выбора местонахождения предприятия с использованием карты.
- Часть информации предприятия закрыта от общего доступа и предоставляется на платной основе.

Любое добавление или изменения предприятия проходит модерацию:

- Деактивация предприятия на период модерации.
- Имеется возможность просмотра, какие именно поля и части контента были изменены, с визуальным выделением старых и 
новых значений.
- Возможность вести диалог о заполняемом объекте пользователю и администратору сайта: пользователю - для задания 
уточняющих вопросов, администратору - для ответа на них или запроса корректировок.
- Сохранение истории изменений и возможность откатиться на предыдущую версию.
- Уведомления администратору и пользователю о необходимости внесения изменений.

### Дальнейшие доработки

Впоследствии была добавлена возможность просмотра предприятий рядом для выбранного предприятия / населенного пункта в 
определенном радиусе. Для данной функциональности был подключен PostGIS и выполнена миграция географических координат.

## Торговая площадка

Еще один новый модуль для публикации и просмотра объявлений о купле / продаже сельскохозяйственных культур. От 
стандартных досок объявлений его отличает в первую очередь тот факт, что объявление может быть добавлено только от лица 
предприятия и более тщательная проверка, что значительно уменьшает вероятность действий на сайте посторонних лиц.

Связь с предприятием также:

- Способствует заполнению базы предприятий.
- Помогает получить больше информации о продавце / покупателе и посмотреть его местоположение.

Реализованная функциональность также включает в себя:

- Добавлен фильтр по основным критериям.
- Добавлена система модерации по аналогии с предприятиями.
- Добавлена возможность подачи жалобы на объявление. Все жалобы проходят модерацию, после чего происходит информирование 
пользователей.
- Количественные и временные ограничения на добавление объявления отражены в правах пользователя.
- Часть информации объявления закрыта от общего доступа и предоставляется на платной основе.

## Подписка

До создания этого модуля для предоставления платных услуг использовалось назначение пользователям групп с 
соответствующим набором прав. Помимо выставления группы вручную, ее также необходимо было в нужный момент убрать для 
деактивации подписки. Очевидно, что с ростом количества заказов такой подход значительно усложнял работу с клиентами. 
Было принято решение о создании полноценной e-commerce платформы.

### Модульные подписки

Сформированы подписки с наборами прав, открывающие функциональность в пределах опреденного модуля, а также с полным 
доступом. Введены временные ограничения по сроку действия - от 1 месяца до 1 года.

### Подписки на объекты

После изучения спроса стало известно, что далеко не всем клиентам требуются модульные подписки - есть такие, кому, 
например, нужно получить полный доступ к одному конкретному предприятию. Исходя из этого, были введены подписки на 
объекты, предоставляемые бессрочно. Реализация исключает необходимость создания отдельных товаров для интернет-магазина.
 
### Особенности

Дополнительно были реализованы следующие возможности:

- Комбинирование и продление подписок.
- Пробный период, в ходе которого можно бесплатно попробовать и оценить платную функциональность сайта.
- Для исключительных случаев добавлено формирование заказа администратором с переработанным интерфейсом для поддержки 
обоих типов подписок. Присутствует возможность создания заказа "задним числом" для переноса подписок, созданных ранее 
через присвоение пользователям групп вручную.
- Оплата с помощью банковских карт (VISA, MasterCard) с моментальной активацией выбранных услуг.

## Прочее

Из прочих нововведений можно отметить:

- Помимо Disqus, были задействованы и другие сторонние сервисы - для уведомлений, а также отзывов и идей пользователей.
- Введение уведомлений (статические, всплывающие, web push, email) для оповещения о результатах действий / статусов 
объектов.
- CSS и JS зависимости оптимизированы с использованием Django Compressor, включая административную часть.

Разработаны JS плагины:

- Форма с клиентской валидацией и отправкой через AJAX.
- Плагин зависимых выпадающих списков с поддержкой одновременного обновления нескольких зависимых списков.
- Заменяемый блок с использованием pjax.

## Дальнейшее развитие

Сайт активно развивается, растет количество пользователей и подписчиков. В планах разработка нового модуля.
