---
title: Psychological tests online
site: http://tests-psychology.com/
year: 2013 - 2016
description: >
  Service providing a set of different psychological tests for passing online with automatic calculation of results.
technologies:
  - PHP
  - 1C-Bitrix
  - Yii
  - MySQL
  - JavaScript
  - jQuery
screenshots: [home, menu, sign_up, tests, test, passing, saved_passings]
---

## История

В компанию "INSY" обратился частный психолог с целью создания сервиса психологических тестов для прохождения онлайн.
Несмотря на то, что подобные сервисы уже существовали (в том числе и рассчитанные на русскоязычную аудиторию), заказчик
хотел проект, выделяющийся на фоне конкурентов за счет следующих факторов:

- Яркий, привлекательный дизайн. Заказчик отмечал, что некоторые из подобных сервисов выглядят очень примитивно, как в 
90е.
- Полный отказ от рекламы на сайте. По словам заказчика, некоторые сервисы, будучи довольно качественными, отталкивали
обилием баннеров и рекламных ссылок.
- Максимально удобный процесс прохождения в плане интерфейса и удобства пользования. Тестируемого не должно ничего 
отвлекать - ни дизайн, ни реклама, ни что-либо еще.
- Наличие редких и сложных тестов, полная автоматизация подсчета результатов.

## Этап 1 - Разработка на 1C-Bitrix CMS в компании INSY

Разработка проекта первоначально выполнялась в компании "INSY". После того, как другим штатным сотрудником был выполнен 
дизайн, проект был передан мне на верстку.

### Верстка

Из-за необычного дизайна верстка была также не самой тривиальной задачей. Нестандартные элементы и их стыковка отняли
больше времени, чем обычно. В основе дизайна лежит дерево:

- крона является хедером сайта. Плоды в виде яблок формируют главное меню.
- Ствол содержит список вложенных категорий тестов. Категории верхнего уровня имеют тематические картинки для 
визуализации.
- Футер дублирует главное меню сайта. Это удобно для быстрой навигации, когда скролл ближе к низу страницы и является 
своего рода альтернативой популярной сейчас кнопке быстрого возврата в верх сайта.

Конечно, такой дизайн идет вразрез с современными трендами, к тому же не является адаптивным, поэтому приходится часто
пользоваться зумом на мобильных устройствах. Тем не менее, пожелание заказчика было выполнено, и он остался доволен. 
Кроме этого, пользователи сайта тоже отмечали оригинальность такого оформления.

### Программирование

Для данного проекта руководством было решено использовать CMS 1C-Bitrix. И если она помогла ускорить выполнение задач, 
связанных с контентом и иерархическими структурами, то для ключевой задачи - заполнения и прохождения разных типов 
тестов - оказалась практически бесполезна в силу специфики предметной области. Поэтому данную функциональность пришлось 
реализывовать с нуля. После оценки затрат и сложности доработок в backend части и соотнесения их с бюджетом и сроками 
сдачи проекта, было принято решение использовать XML для хранения данных теста. Заказчика такой вариант устраивал.

Был реализован автоматический подсчет результатов, но из-за ограничений по времени и бюджету не удалось сделать процесс 
прохождения удобным, без перезагрузки страницы. Для получения прибыли с сайта часть тестов планировалось сделать 
закрытыми, с оплатой для получения доступа. Как правило, это наиболее сложные тесты, отсутствующие в свободном доступе и 
предлагающие глубокий анализ в опреденной проблеме. Данная функциональность также была добавлена, для оплаты была 
произведена интеграция с платежными терминалами и кошельками QIWI.

Сайт был запущен, и началось заполнение контента. Реализованный алгоритм не покрывал все необходимые типы тестов, так 
как сначала было решено реализовать поддержку только базовых и часто используемых типов. Для поддержки новых типов 
приходилось постоянно модифицировать XML схему с сохранением обратной совместимости. Для особо сложных видов тестов это 
или занимало много времени, или было невозможно вообще. Постоянно возрастающая сложность схемы также делала заполнение и 
редактирование тестов для заказчика еще более неудобными.

## Этап 2 - Переход на Yii Framework и дальнейшие улучшения

Позднее заказчик связался со мной и предложил продолжить работу по проекту. На тот момент я уже работал в компании
"Fora", но согласился взять проект в качестве подработки.

### Доработки по дизайну и верстке

В первую очередь, требовалось выполнить некоторые доработки по дизайну и верстке в соответствии с новыми требованиями 
заказчика. Для этого были разово привлечены мои знакомые верстальщик и дизайнер, и работа была выполнена. Одним из 
главных нововведений стало появление модального окна и нового интерфейса для прохождения теста. Помимо повышения 
удобства, решилась и другая задача - предотвращение отвлечения внимания за счет более темного фона. Были добавлены и 
некоторые другие мелочи, например, сова, машущая крылом и переключающая случайные цитаты знаменитых психологов.

В дальнейшем было принято решение от отказа поддержки старых браузеров (например, Internet Explorer 8), и я значительно 
упростил верстку, избавившись от большого количества избыточных блоков и изображений. Дальнейшие работы по верстке 
проводились самостоятельно. Для упрощения поддержки был произведен переход на Sass.

### Программирование

Оценив сложность дальнейшего развития проекта на CMS 1C-Bitrix, было принято решение о полном переписывании проекта на 
Yii Framework, который на тот момент я осваивал в "Fora". Структура тестов была переделана с использованием моделей. 
Для подсчета результатов было решено использовать выражения, содержащие ссылки на ключевые объекты их значения, а также 
базовые арифметические и логические операции, которые впоследствии расширялись многими другими, например, вхождением 
одного множества в другое и т.д. Использование `eval` я сразу исключил, а подходящей библиотеки для решения данной 
задачи на тот момент найдено не было, поэтому я написал свой компонент, основанный на регулярных выражениях.

Процесс прохождения тестов был переписан с использованием JavaScript и jQuery, чтобы исключить лишние перезагрузки 
страницы. Была добавлена возможность использовать только клавиатуру в качестве навигации и ответов на вопросы.

## Этап 3 - Переход на Yii 2 Framework и дальнейшие улучшения

В какой-то момент в компании "Fora" мы стали использовать вторую версию Yii, так как первая сильно устаревала и была 
более сложной в поддержке. Вместе с этим, я принял решение также перевести этот проект на более новую версию. Как 
оказалось - не зря. Кодовая база была еще не настолько велика, и процесс миграции прошел довольно быстро. Работать с 
проектом стало проще.

### Интеграция сторонней библиотеки для выражений

На данном этапе была найдена сторонняя библиотека для работы с выражениями для подсчета результов. Она оказалась более 
гибкой и расширяемой, поэтому я интегрировал ее и убрал свои наработки. Алгоритм подсчета, основанный на выражениях, 
подошел для всех видов тестов.
 . 
### Организация удобного заполнения тестов

Следующим немаловажным моментом было создание удобного инструмента для заполнения данных. Как правило, тест содержал 
большое количество связанных иерархических данных. Использование веб интерфейса занимало много времени и не 
обеспечивало нужного уровня удобства. Заказчик высказал пожелание об использовании Excel. Проблема была решена 
написанием компонента [yii2-excel][yii2-excel], исходный код которого доступен на Github. Список возможностей импорта 
можно посмотреть в документации к [Basic import][yii2-excel Basic import] и [Advanced import][yii2-excel Advanced 
import].

Использование Excel было удобным для первичного импорта большого объема связанных данных. В дополнение к этому, веб
интерфейс редактирования теста был значительно переработан - выделена иерархия объектов, улучшена навигация.

Позднее к заполнению тестов были привлечены контент-менеджеры. Права доступа были соответствующим образом 
отрегулированы.

### Прочие доработки

Был произведен ряд других доработок:

- Добавлена возможность использования кодов доступа для бесплатного прохождения закрытых тестов на ограниченный период
времени.
- В общий результат теста, помимо выводов автора теста, теперь могут быть включены комментарии психолога, информация о
связанных тестах, проходящих тренингах, рекомендации пройти консультацию.
- Добавлена функция сохранения и повторного просмотра результатов пройденных тестов.

Страница списка тестов была также переработана:

- Добавлены фильтры, включающие редактируемый набор свойств.
- Для формирования сетки блоков с разной величиной контента и оптимального использования имеющегося пространства 
подключена библиотека Masonry.

Была улучшена система сборки JS и CSS зависимостей проекта с использованием Grunt, настроено развертывание с 
использованием Deployer. 

## Дальнейшее развитие

Проект был ориентирован на широкую аудиторию и имел большой потенциал. Из-за того, что занимался им я один и только в
свободное от основной работы время, разработка шла довольно медленно. Особенно много времени ушло на разработку и 
реализацию структуры тестов и компонента подсчета результатов, а также адаптацию их под все типы тестов, так как новые
требования выяснялись по ходу работы. Что касается заказчика, для него это был экспериментальный проект, которым он 
также занимался помимо основной работы. Из-за отсутствия дополнительного финансирования и инвестирования привлечение
большего количества людей было невозможным.

В определенный момент работы над проектом выяснилось, что стратегия по извлечению прибыли оказалась провальной. По 
инициативе заказчика работа над проектом была приостановлена. Дальнейшее заполнение контента также не производится. 
После этого финансовая стратегия была пересмотрена, и все силы были брошены на создание нового проекта на основе
имеющейся базы - [Tests-Psychology Corp][Tests-Psychology Corp].

Для меня это был самый масштабный проект, которым я занимался параллельно с основной работой. Несмотря на то, что сейчас 
он заморожен, я получил хороший опыт решения сложных практических задач.

[yii2-excel]: https://github.com/arogachev/yii2-excel
[yii2-excel Basic import]: https://github.com/arogachev/yii2-excel/blob/master/docs/import-basic.md
[yii2-excel Advanced import]: https://github.com/arogachev/yii2-excel/blob/master/docs/import-advanced.md
[Tests-Psychology Corp]: /portfolio/projects/tests-psychology-corp/
